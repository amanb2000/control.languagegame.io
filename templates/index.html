<!DOCTYPE html>
<html>
<head>
    <title>Inference Interface</title>
    <script src="https://unpkg.com/htmx.org@1.6.0"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1>LLM Control Challenge</h1>
        <h2>Greedy GPT-2 Generation</h2>
        <p>
            Your goal is to find an optimal prompt \(\mathbf u \in \mathcal V^k\) s.t.
            the output of the LLM \(\mathbf y\) is steered to the desired output \(\mathbf y^*\)
            given imposed state \(\mathbf x_0\).
        </p>
        <form hx-post="/inferencegenerate" hx-target="#generated-text">
            <div class="form-group">
                <label for="system-prompt">Control input \(\mathbf u\):</label>
                <input type="text" class="form-control" id="system-prompt" name="system_prompt" required>
            </div>
            <div class="form-group">
                <label for="input-string">Imposed State \(\mathbf x_0\):</label>
                <textarea class="form-control" id="input-string" name="input_string" rows="5" readonly>Roger Federer is the </textarea>
            </div>
            <div class="form-group">
                <label for="desired-output">Desired Output \(\mathbf y^*\):</label>
                <input type="text" class="form-control" id="desired-output" name="desired_output" value="greatest" readonly>
            </div>
            <input type="hidden" name="num_tokens" value="1" readonly>
            <button type="submit" class="btn btn-primary">Generate</button>
        </form>
        <div id="generated-text" class="mt-3"></div>
        <div id="output-check" class="mt-3"></div>
    </div>
    <script>
        document.body.addEventListener('htmx:afterRequest', function(evt) {
            if (evt.detail.requestConfig.target === '#generated-text') {
                const generatedText = document.getElementById('generated-text').textContent;
                const desiredOutput = document.getElementById('desired-output').value;
                const outputCheck = document.getElementById('output-check');

                if (generatedText.startsWith(desiredOutput)) {
                    outputCheck.textContent = 'Generated text matches the desired output!';
                    outputCheck.className = 'text-success';
                } else {
                    outputCheck.textContent = 'Generated text does not match the desired output.';
                    outputCheck.className = 'text-danger';
                }
            }
        });
    </script>
</body>
</html>