<!DOCTYPE html>
<html>
<head>
    <title>Inference Interface</title>
    <script src="https://unpkg.com/htmx.org@1.6.0"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1>LLM Control Challenge</h1>
        <h2>Greedy GPT-2 Generation</h2>
        <p>
            Your goal is to find an optimal prompt \(\mathbf u \in \mathcal V^k\) s.t.
            the output of the LLM \(\mathbf y\) is steered to the desired output \(\mathbf y^*\)
            given imposed state \(\mathbf x_0\).
        </p>
        <p>
            LLM control theory seminar: <a href="https://youtu.be/tlAhCuekN6Q?si=ipZoBVVPSpyF24GU">Overview (2min)</a>, <a href="https://youtu.be/9QtS9sVBFM0?si=6O65NZuv_kLOFk84">Full (1h)</a>
        </p>
        <p>
            Paper: <a href="https://arxiv.org/abs/2310.04444">What's the Magic Word? A Control Theory of LLM Prompting
            </a> (arXiv:2310.04444)
        </p>
        <!-- Image from reachability.png -->
        <!-- center div-->
        <div style="display: flex; justify-content: center;">
            <img src="https://i.imgur.com/odiaPs9.png" class="img-fluid" alt="Reachability" style="max-height: 300px; width: auto;">
        </div>
        <!-- <form hx-post="/inferencegenerate" hx-target="#generated-text">
            <div class="form-group">
                <label for="system-prompt">Control input \(\mathbf u\):</label>
                <input type="text" class="form-control" id="system-prompt" name="system_prompt" required>
            </div>
            <div class="form-group">
                <label for="input-string">Imposed State \(\mathbf x_0\):</label>
                <textarea class="form-control" id="input-string" name="input_string" rows="5" readonly>Roger Federer is the </textarea>
            </div>
            <div class="form-group">
                <label for="desired-output">Desired Output \(\mathbf y^*\):</label>
                <input type="text" class="form-control" id="desired-output" name="desired_output" value="greatest" readonly>
            </div>
            <div class="form-group">
                <label for="generated-text">Actual Output \(\mathbf y\):</label>
                <div id="generated-text" class="mt-3"></div>
            </div>
            <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" id="cheat-checkbox">
                <label class="form-check-label" for="cheat-checkbox">Let me cheat</label>
            </div>
            <input name="num_tokens" value="6" readonly>
            <button type="submit" class="btn btn-primary">Generate</button>
        </form> -->
        <form hx-post="/inferencegenerate" hx-target="#generated-text">
            <div class="form-group">
                <label for="nickname">Nickname for leaderboard:</label>
                <input type="text" class="form-control" id="nickname" name="nickname" placeholder="Your nickname here..." required>
            </div>
            <div class="form-group">
                <label for="system-prompt">Control input \(\mathbf u\):</label>
                <input type="text" class="form-control bg-dark text-light" id="system-prompt" name="system_prompt" placeholder="Your prompt here..." required>
            </div>
            <div class="form-group">
                <label for="input-string">Imposed State \(\mathbf x_0\):</label>
                <textarea class="form-control bg-success text-light" id="input-string" name="input_string" rows="5" readonly>Roger Federer is the </textarea>
            </div>
            <div class="form-group">
                <label for="desired-output">Desired Output \(\mathbf y^*\):</label>
                <input type="text" class="form-control bg-warning text-dark" id="desired-output" name="desired_output" value="greatest" readonly>
            </div>
            <div class="form-group">
                <label for="generated-text">Actual Output \(\mathbf y\):</label>
                <div id="generated-text" class="mt-3 bg-warning text-dark"></div>
            </div>
            <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" id="cheat-checkbox">
                <label class="form-check-label" for="cheat-checkbox">Let me cheat</label>
            </div>
            <input name="num_tokens" value="6" hidden readonly>
            <button type="submit" class="btn btn-primary">Generate</button>
        </form>
        <div id="generated-text" class="mt-3"></div>
        <!-- <div id="output-check" class="mt-3"></div> -->
    </div>
    <script>
        const cheatCheckbox = document.getElementById('cheat-checkbox');
        const inputString = document.getElementById('input-string');
        const desiredOutput = document.getElementById('desired-output');

        cheatCheckbox.addEventListener('change', function() {
            if (this.checked) {
                inputString.readOnly = false;
                desiredOutput.readOnly = false;
            } else {
                inputString.readOnly = true;
                desiredOutput.readOnly = true;
            }
        });
    </script>
</body>
</html>